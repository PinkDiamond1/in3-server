
/***********************************************************
* This file is part of the Slock.it IoT Layer.             *
* The Slock.it IoT Layer contains:                         *
*   - USN (Universal Sharing Network)                      *
*   - INCUBED (Trustless INcentivized remote Node Network) *
************************************************************
* Copyright (C) 2016 - 2018 Slock.it GmbH                  *
* All Rights Reserved.                                     *
************************************************************
* You may use, distribute and modify this code under the   *
* terms of the license contract you have concluded with    *
* Slock.it GmbH.                                           *
* For information about liability, maintenance etc. also   *
* refer to the contract concluded with Slock.it GmbH.      *
************************************************************
* For more information, please refer to https://slock.it   *
* For questions, please contact info@slock.it              *
***********************************************************/

import { assert } from 'chai'
import 'mocha'
import { util, BlockData, serialize, Signature, RPCRequest, RPCResponse } from 'in3'
import { encodeObject } from '../../src/util/binjson'


describe('useBinary', () => {

    it('simple Object', () => {
        assert.equal(encodeObject({ a: 1 }).toString('hex'), 'c2610061a1')
        assert.equal(encodeObject({ a: 1, abcdef: true }).toString('hex'), 'c3620061a1f38781')
    })
    it('simple Array', () => {
        assert.equal(encodeObject([]).toString('hex'), 'c140')
        assert.equal(encodeObject(['123', '0x123', 1, true]).toString('hex'), 'c5442331323300bd0123a181')
    })
    it('simple integer', () => {
        assert.equal(encodeObject(0xffffff).toString('hex'), 'c1beffffff')
        assert.equal(encodeObject(0xffffffff).toString('hex'), 'c104ffffffff')
        assert.equal(encodeObject(0x1).toString('hex'), 'c1a1')
    })
    it('complex json', () => {
        const hexData = encodeObject({ "jsonrpc": "2.0", "result": { "blockHash": "0x2dbbac3abe47a1d0a7843d378fe3b8701ca7892f530fd1d2b13a46b202af4297", "blockNumber": "0x79fab6", "chainId": "0x1", "condition": null, "creates": null, "from": "0x2c5811cb45ba9387f2e7c227193ad10014960bfc", "gas": "0x186a0", "gasPrice": "0x4a817c800", "hash": "0xf84cfb78971ebd940d7e4375b077244e93db2c3f88443bb93c561812cfed055c", "input": "0xa9059cbb000000000000000000000000290648fc6f2cb27a2a81dc35a429090872991b92000000000000000000000000000000000000000000000015af1d78b58c400000", "nonce": "0xa8", "publicKey": "0x6b30c392dda89d58866bf2c1bedf8229d12c6ae3589d82d0f52ae588838a475aacda64775b7a1b376935d732bb8022630a01c4926e71171eeda938b644d83365", "r": "0x4666976b528fc7802edd9330b935c7d48fce0144ce97ade8236da29878c1aa96", "raw": "0xf8ab81a88504a817c800830186a094d3ebdaea9aeac98de723f640bce4aa07e2e4419280b844a9059cbb000000000000000000000000290648fc6f2cb27a2a81dc35a429090872991b92000000000000000000000000000000000000000000000015af1d78b58c40000025a04666976b528fc7802edd9330b935c7d48fce0144ce97ade8236da29878c1aa96a05089dca7ecf7b061bec3cca7726aab1fcb4c8beb51517886f91c9b0ca710b09d", "s": "0x5089dca7ecf7b061bec3cca7726aab1fcb4c8beb51517886f91c9b0ca710b09d", "standardV": "0x0", "to": "0xd3ebdaea9aeac98de723f640bce4aa07e2e44192", "transactionIndex": "0x3e", "v": "0x25", "value": ":13" }, "id": 2, "in3": { "lastValidatorChange": 0, "execTime": 2117, "rpcTime": 2117, "rpcCount": 1, "currentBlock": 1, "lastNodeList": 8026154 } }).toString('hex')
        assert.equal(hexData, 'dc1f64b6f923322e3000b689749a5b1c202dbbac3abe47a1d0a7843d378fe3b8701ca7892f530fd1d2b13a46b202af429764cabe79fab62440a10873c0bb77c00496142c5811cb45ba9387f2e7c227193ad10014960bfcf0f5be0186a042b80504a817c8004d921c20f84cfb78971ebd940d7e4375b077244e93db2c3f88443bb93c561812cfed055c8df61c44a9059cbb000000000000000000000000290648fc6f2cb27a2a81dc35a429090872991b92000000000000000000000000000000000000000000000015af1d78b58c4000004669bca8cfd61c406b30c392dda89d58866bf2c1bedf8229d12c6ae3589d82d0f52ae588838a475aacda64775b7a1b376935d732bb8022630a01c4926e71171eeda938b644d8336500721c204666976b528fc7802edd9330b935c7d48fce0144ce97ade8236da29878c1aa96b0e41cadf8ab81a88504a817c800830186a094d3ebdaea9aeac98de723f640bce4aa07e2e4419280b844a9059cbb000000000000000000000000290648fc6f2cb27a2a81dc35a429090872991b92000000000000000000000000000000000000000000000015af1d78b58c40000025a04666976b528fc7802edd9330b935c7d48fce0144ce97ade8236da29878c1aa96a05089dca7ecf7b061bec3cca7726aab1fcb4c8beb51517886f91c9b0ca710b09d00731c205089dca7ecf7b061bec3cca7726aab1fcb4c8beb51517886f91c9b0ca710b09d8fcda03a1b14d3ebdaea9aeac98de723f640bce4aa07e2e4419204babc3e0076bc254a6b233a313300348da27734666b72a01caebd0845e4d4bd08450822a187a0a14508be7a782a')
    })

    it('eth_getBalance Response Encoding Test', () => {
        const hexData = encodeObject({"id":1,"jsonrpc":"2.0","result":"0x0","in3":{"proof":{"type":"accountProof","block":"0xf901eea05c6c80518d1c32f76b4345f3fdc115e55dbf870847a8ce6f7984bc8d306a3375a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a0251dc2c8ab21b965d132a0ce493561d4a5a425d7c60b61e8d101b6e89cfc647da0101587a9d69ec3f549a3f0ef4e00c0f2dc4edb382edafc7e682dd4d36a56f4b4a0056b23fbba480696b65fe5a59b8f2148a1299103c4f57df839233af2cf4ca2d2b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000830200006b837a1200825208845d2702a89fde830205058f5061726974792d457468657265756d86312e33362e30826c69","signatures":[{"blockHash":"0x1148880419d38f777f2f4c3cd24ea43e11e80ddb5ffaf3a8f6dc462e75290488","block":107,"r":"0x426a2d94399614dc873e7b965ca5c0d82573ef01cddf5b0e3d6f65e5880b6249","s":"0x186c8d947adc2a2685543503fda6b93162bf9173f57565373a6cc9bf59967718","v":27,"msgHash":"0x08aa1924fd3277eda8709fa9b4986b5bd75b3762ede85189bc42ba39dc768ef8"}],"accounts":{"0xc94770007dda54cF92009BFF0dE90c06F603a09f":{"accountProof":["0xf90211a0fbb3a5f76c0f0643ed0cfd81a71721fa3cf7aac211e5ad1fcb5158278b7f4459a0ab8cdb808c8303bb61fb48e276217be9770fa83ecf3f90f2234d558885f5abf1a04d8f6f62bfb7ea8288cefce29bbb0ac841fccc5cc954579d3a04a830dde3e73fa0d1d79fdc1b22fd6c170e1336b95fe3e14caac84ac16f66083a77f0b344273892a0bc6a665110c5f15162948e94389953299347be8f5008c010dbbf500528b0acc0a0b090733a4b744345d10ddf9353b852c0989c54f4f45b84c406794a0dd1d17147a01d53cd0d06a300355ab48d4293d14cc8128001665f7bf744adb724141b036e91a0f26b933b7962289273548dad944b524adfad35928d322c566238fe248ebc66d8a09539075d54d2984336c730a8e64bc056e9d40b7841db53b96e579d2cfeb61463a0d412afee38c7c4c7500be0a40153706a524b24346ee7776a9ee027ae8a8709e5a01055b5bc7fcb675f282188c72bf875e513368cb53fc0735f7280f2700caa9695a0bdd282160470f03297467ce82562dd164a9d4b23a569c1ff6b6a73985376e3a1a0b6f0c67d92f82b64db0f420665f2ba0f40b53e176bff4e31c81672027536b3c8a0e898d46ca0d51f051ca05bb074a697f228dc1db5fe674c474b757670a15bbc0fa0a4a064a22a66efce2257ca5724250a5393f29bf929f8c60c19141f47fe1d898ea0ff78ee0452622b868bedbf8ca0886289a8da938baa143f123bbd914f6d2b07d880","0xf8518080808080808080a095df9e8ccacac74ee3378b89344a6c53c47d975f469cf910ff348b8ebcf38963808080a09f8b4c92e42341b2044494e20dc33aaf68b46cf239f60a4bf97eb12a4042ff7680808080","0xf869a020bd6da878b9d44312ac3b5e3c39a309c4f28eb9dad4a4815669c3eeaf88e44cb846f8440180a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0331c1829a6ed0e024ee0befeacd6eb40bd5e6c95b18bd3760598f8ccd7f86d19"],"address":"0xc94770007dda54cf92009bff0de90c06f603a09f","balance":"0x0","codeHash":"0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470","nonce":"0x0","storageHash":"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421","storageProof":[]}}},"currentBlock":186,"lastNodeList":54,"execTime":7,"rpcTime":2,"rpcCount":1}}).toString('hex')
        assert.equal(hexData, 'dc2164348da1b6f923322e3000b689a07734664ee46442182c6163636f756e7450726f6f6600c7e91d01f1f901eea05c6c80518d1c32f76b4345f3fdc115e55dbf870847a8ce6f7984bc8d306a3375a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a0251dc2c8ab21b965d132a0ce493561d4a5a425d7c60b61e8d101b6e89cfc647da0101587a9d69ec3f549a3f0ef4e00c0f2dc4edb382edafc7e682dd4d36a56f4b4a0056b23fbba480696b65fe5a59b8f2148a1299103c4f57df839233af2cf4ca2d2b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000830200006b837a1200825208845d2702a89fde830205058f5061726974792d457468657265756d86312e33362e30826c69b29741669a5b1c201148880419d38f777f2f4c3cd24ea43e11e80ddb5ffaf3a8f6dc462e75290488c7e9bc6b00721c20426a2d94399614dc873e7b965ca5c0d82573ef01cddf5b0e3d6f65e5880b624900731c20186c8d947adc2a2685543503fda6b93162bf9173f57565373a6cc9bf599677180076bb244b1c2008aa1924fd3277eda8709fa9b4986b5bd75b3762ede85189bc42ba39dc768ef84192616414670f25431d0214f90211a0fbb3a5f76c0f0643ed0cfd81a71721fa3cf7aac211e5ad1fcb5158278b7f4459a0ab8cdb808c8303bb61fb48e276217be9770fa83ecf3f90f2234d558885f5abf1a04d8f6f62bfb7ea8288cefce29bbb0ac841fccc5cc954579d3a04a830dde3e73fa0d1d79fdc1b22fd6c170e1336b95fe3e14caac84ac16f66083a77f0b344273892a0bc6a665110c5f15162948e94389953299347be8f5008c010dbbf500528b0acc0a0b090733a4b744345d10ddf9353b852c0989c54f4f45b84c406794a0dd1d17147a01d53cd0d06a300355ab48d4293d14cc8128001665f7bf744adb724141b036e91a0f26b933b7962289273548dad944b524adfad35928d322c566238fe248ebc66d8a09539075d54d2984336c730a8e64bc056e9d40b7841db53b96e579d2cfeb61463a0d412afee38c7c4c7500be0a40153706a524b24346ee7776a9ee027ae8a8709e5a01055b5bc7fcb675f282188c72bf875e513368cb53fc0735f7280f2700caa9695a0bdd282160470f03297467ce82562dd164a9d4b23a569c1ff6b6a73985376e3a1a0b6f0c67d92f82b64db0f420665f2ba0f40b53e176bff4e31c81672027536b3c8a0e898d46ca0d51f051ca05bb074a697f228dc1db5fe674c474b757670a15bbc0fa0a4a064a22a66efce2257ca5724250a5393f29bf929f8c60c19141f47fe1d898ea0ff78ee0452622b868bedbf8ca0886289a8da938baa143f123bbd914f6d2b07d8801c53f8518080808080808080a095df9e8ccacac74ee3378b89344a6c53c47d975f469cf910ff348b8ebcf38963808080a09f8b4c92e42341b2044494e20dc33aaf68b46cf239f60a4bf97eb12a4042ff76808080801c6bf869a020bd6da878b9d44312ac3b5e3c39a309c4f28eb9dad4a4815669c3eeaf88e44cb846f8440180a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0331c1829a6ed0e024ee0befeacd6eb40bd5e6c95b18bd3760598f8ccd7f86d19b2f614c94770007dda54cf92009bff0de90c06f603a09f71e6a05e3f1c20c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a4704669a06d4b1c2056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b42102bd4087a0bcba4508bc361caea7e4d4a20822a1')
    })

    it('eth_getTransactionReceipt Response Encoding Test', () => {
        const hexData = encodeObject({"jsonrpc":"2.0","result":{"blockHash":"0x5b6f9359408d83bd4463ff5e0fcd271cee7dba1e3b546a50d0372ad3ffb01b64","blockNumber":"0x89","contractAddress":null,"cumulativeGasUsed":"0x5208","from":"0x600789808c59be070e588605d051bf154fedfbfa","gasUsed":"0x5208","logs":[],"logsBloom":"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","root":null,"status":"0x1","to":"0x58069183839efae966425abbf0bfeb5d777fbcfb","transactionHash":"0xf9d75a289a1d3dcbdb4f83753475bafcb8743d56842e835b32bc6f1e516dc1a3","transactionIndex":"0x0"},"id":1,"in3":{"proof":{"type":"receiptProof","block":"0xf901efa0d4e79a0e3c2a7d474966e1ebd740bd61e00a9de146633690eba442a314dd908fa01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a030bf09c9db5367cdef26dc4a12bc0965a671c953bed5170c3b3fa8605f7ad98aa0fefa2914c2ad6070538a7a46734d73cd484bf98b62b4f81ce1176e8f10bdbccca0056b23fbba480696b65fe5a59b8f2148a1299103c4f57df839233af2cf4ca2d2b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000830200008189837a1200825208845d3062a09fde830205058f5061726974792d457468657265756d86312e33362e30826c69","txProof":["0xf86b822080b866f8640e843b9aca00832dc6c09458069183839efae966425abbf0bfeb5d777fbcfb0a8026a0cba989e143de80158eaa6bec1cd68c9eef10ab12d31b4b47cd974999f755ad5da06a21616a730c26c3218632da605faa3b99d3d8b4b4ee8a9ee92ba2d5fe580574"],"merkleProof":["0xf90111822080b9010bf9010801825208b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0"],"txIndex":0,"signatures":[{"blockHash":"0x5b6f9359408d83bd4463ff5e0fcd271cee7dba1e3b546a50d0372ad3ffb01b64","block":137,"r":"0xa31321925597ed63df6b17d35f6593f0d121eaefa73c970367111277212c0560","s":"0x7102bedf4e936500ad752c08c6c636d2eeacf787a1d116090d6036a682eb81bf","v":27,"msgHash":"0x35025c09aac6dc5fe33d2342826f1e400ec42a08fa81e8665976acba8aaa3320"}],"merkleProofPrev":false},"currentBlock":186,"lastNodeList":54,"execTime":14,"rpcTime":12,"rpcCount":3}}).toString('hex')

        assert.equal(hexData, "dc2864b6f923322e3000b6896d9a5b1c205b6f9359408d83bd4463ff5e0fcd271cee7dba1e3b546a50d0372ad3ffb01b6464cabc89f5c4c05e7fbd5208049614600789808c59be070e588605d051bf154fedfbfa68d2bd5208c59740cfd41d0100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004e86c07394a13a1b1458069183839efae966425abbf0bfeb5d777fbcfb6ed61c20f9d75a289a1d3dcbdb4f83753475bafcb8743d56842e835b32bc6f1e516dc1a304baa0348da17734664ee46742182c7265636569707450726f6f6600c7e91d01f2f901efa0d4e79a0e3c2a7d474966e1ebd740bd61e00a9de146633690eba442a314dd908fa01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a030bf09c9db5367cdef26dc4a12bc0965a671c953bed5170c3b3fa8605f7ad98aa0fefa2914c2ad6070538a7a46734d73cd484bf98b62b4f81ce1176e8f10bdbccca0056b23fbba480696b65fe5a59b8f2148a1299103c4f57df839233af2cf4ca2d2b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000830200008189837a1200825208845d3062a09fde830205058f5061726974792d457468657265756d86312e33362e30826c6972c8411c6df86b822080b866f8640e843b9aca00832dc6c09458069183839efae966425abbf0bfeb5d777fbcfb0a8026a0cba989e143de80158eaa6bec1cd68c9eef10ab12d31b4b47cd974999f755ad5da06a21616a730c26c3218632da605faa3b99d3d8b4b4ee8a9ee92ba2d5fe580574fb5c411d0114f90111822080b9010bf9010801825208b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0b9d2a0b29741669a5b1c205b6f9359408d83bd4463ff5e0fcd271cee7dba1e3b546a50d0372ad3ffb01b64c7e9bc8900721c20a31321925597ed63df6b17d35f6593f0d121eaefa73c970367111277212c056000731c207102bedf4e936500ad752c08c6c636d2eeacf787a1d116090d6036a682eb81bf0076bb244b1c2035025c09aac6dc5fe33d2342826f1e400ec42a08fa81e8665976acba8aaa332061ed8087a0bcba4508bc361caeaee4d4ac0822a3")
    })
 
})
